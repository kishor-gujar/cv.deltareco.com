
@model cv.deltareco.com.ViewModels.HomeViewModel

@{
	
    ViewData["Title"] = "Dashboard";
    Layout = "/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<!-- Page Wrapper -->
<div class="page-wrapper">
	<div class="content">
		<!-- Breadcrumb -->
		<div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
			<div class="my-auto mb-2">
				<h2 class="page-title text-primary fw-bold">Admin Dashboard</h2>
				<nav>
					<ol class="breadcrumb mb-0">
						<li class="breadcrumb-item">
							<a href="index.html"><i class="ti ti-smart-home"></i></a>
						</li>
						<li class="breadcrumb-item">Dashboard</li>
						<li class="breadcrumb-item active" aria-current="page">Admin Dashboard</li>
					</ol>
				</nav>
			</div>

			<!-- Filters & Export Row -->
			<div class="d-flex flex-wrap align-items-center gap-2 my-xl-auto">

				<div class="d-flex align-items-center">
					<span class="badge bg-primary px-3 py-2  shadow-sm"
						  style="font-size: 13px;">
						<i class="ti ti-calendar-event me-1"></i>
						@DateTime.Now.ToString("dd MMM yyyy")
					</span>
				</div>

				<!-- From / To Date Filters -->
				<div class="d-flex align-items-center gap-2">
					<input type="date" class="form-control form-control-sm" id="fromDate" name="fromDate" value="@Model.FromDate.ToString("yyyy-MM-dd")" placeholder="From Date" />
					<input type="date" class="form-control form-control-sm" id="toDate" name="toDate" value="@Model.ToDate.ToString("yyyy-MM-dd")" placeholder="To Date" />
					<button class="btn btn-primary btn-sm" onclick="applyDateFilter()">Apply</button>
					<button class="btn btn-info btn-sm" onclick="clearDateFilter()">Clear</button>
				</div>

				<!-- Quick Date Dropdown -->
				<div>
					<select class="form-select form-select-sm" id="quickDate" onchange="setQuickDate(this.value)">
						<option value="">Quick Filter</option>
						<option value="today">Today</option>
						<option value="yesterday">Yesterday</option>
						<option value="week">This Week</option>
						<option value="month">Last Month</option>
						<option value="year">This Year</option>
					</select>
				</div>

			</div>

		</div>
		<!-- Welcome Wrap -->
		<div class="card border-0">
			<div class="card-body d-flex align-items-center justify-content-between flex-wrap pb-1">
				@functions {
					private string GetInitials(string fullName)
					{
						if (string.IsNullOrWhiteSpace(fullName))
							return "?";

						var names = fullName.Trim().Split(' ');
						if (names.Length == 1)
							return names[0].Substring(0, 1).ToUpper();

						return (names[0][0].ToString() + names[1][0].ToString()).ToUpper();
					}
				}
				<div class="d-flex align-items-center mb-3">
					<!-- Avatar with initials -->
					<span class="avatar avatar-xl flex-shrink-0 d-flex align-items-center justify-content-center rounded-circle"
						  style="background-color: orange; color: white; font-weight: bold; font-size: 1.5rem; width: 70px; height: 70px;">
						@GetInitials(Model.FullName)
					</span>

					<div class="ms-3">
						<h3 class="mb-2">
							Welcome Back, @Model.FullName
						</h3>
					</div>
				</div>
				<div class="d-flex align-items-center flex-wrap mb-1">
					<a asp-area="Admin" asp-controller="CandidateProfiles" asp-action="Index" class="btn btn-secondary btn-md me-2 mb-2"> <i class="ti ti-square-rounded-plus me-1"></i>Manage Candidate</a>
					<a asp-area="Admin" asp-controller="CV" asp-action="Index" class="btn btn-primary btn-md mb-2" ><i class="ti ti-square-rounded-plus me-1"></i>Candidate's CV</a>
				</div>
			</div>
		</div>
		<!-- /Welcome Wrap -->

		<div class="row">

			<!-- Widget Info -->
			<div class="col-xxl-8 d-flex">
				<div class="row flex-fill">
					<div class="col-md-3 d-flex">
						<div class="card flex-fill shadow-sm border-0"
							 style="background: linear-gradient(135deg, #e6f0ff, #ffffff);
                border-radius: 18px;
                position: relative;
                overflow: hidden;">

							<!-- Faded Icon Background -->
							<i class="ti ti-calendar-check"
							   style="position: absolute;
                  right: -20px;
                  bottom: -10px;
                  font-size: 80px;
                  color: rgba(0, 123, 255, 0.10);"></i>

							<div class="card-body">

								<!-- Main Icon -->
								<span class="avatar rounded-circle bg-primary shadow-sm mb-2"
									  style="width:50px; height:50px; display:flex; align-items:center; justify-content:center;">
									<i class="ti ti-calendar-check fs-20 text-white"></i>
								</span>

								<!-- Label -->
								<h6 class="fs-13 fw-medium text-muted mb-1">Total Users</h6>

								<!-- Count -->
								<h1 class="mb-0 fw-bold text-primary">@Model.TotalUsers</h1>
							</div>
						</div>
					</div>

					<div class="col-md-3 d-flex">
						<div class="card flex-fill shadow-sm border-0"
							 style="background: linear-gradient(135deg, #e6fffa, #ffffff);
                border-radius: 18px;
                position: relative;
                overflow: hidden;">

							<!-- Faded Background Icon -->
							<i class="ti ti-file-text"
							   style="position: absolute;
                  right: -20px;
                  bottom: -10px;
                  font-size: 80px;
                  color: rgba(0, 180, 150, 0.12);"></i>

							<div class="card-body">

								<!-- Main Icon -->
								<span class="avatar rounded-circle bg-info shadow-sm mb-2"
									  style="width:50px; height:50px; display:flex; align-items:center; justify-content:center;">
									<i class="ti ti-file-text fs-20 text-white"></i>
								</span>

								<!-- Label -->
								<h6 class="fs-13 fw-medium text-muted mb-1">Total CV Candidates</h6>

								<!-- Count -->
								<h1 class="mb-0 fw-bold text-info">@Model.TotalCandidateCVCounts</h1>
							</div>
						</div>
					</div>
					<div class="col-md-3 d-flex">
						<div class="card flex-fill shadow-sm border-0"
							 style="background: linear-gradient(135deg, #fff7e6, #ffffff);
                border-radius: 18px;
                position: relative;
                overflow: hidden;">

							<!-- Faded Background Icon -->
							<i class="ti ti-clock"
							   style="position: absolute;
                  right: -20px;
                  bottom: -10px;
                  font-size: 80px;
                  color: rgba(255, 153, 0, 0.12);"></i>

							<div class="card-body">

								<!-- Main Icon -->
								<span class="avatar rounded-circle bg-warning shadow-sm mb-2"
									  style="width:50px; height:50px; display:flex; align-items:center; justify-content:center;">
									<i class="ti ti-clock fs-20 text-white"></i>
								</span>

								<!-- Label -->
								<h6 class="fs-13 fw-medium text-muted mb-1">Recent Uploaded CV</h6>

								<!-- Count -->
								<h1 class="mb-0 fw-bold text-warning">@Model.RecentUploadedCVCounts</h1>
							</div>
						</div>
					</div>

					<div class="col-md-3 d-flex">
						<div class="card flex-fill shadow-sm border-0"
							 style="background: linear-gradient(135deg, #fff3e6, #ffffff);
                border-radius: 18px;
                position: relative;
                overflow: hidden;">

							<!-- Faded Background Icon -->
							<i class="ti ti-users"
							   style="position: absolute;
                  right: -20px;
                  bottom: -10px;
                  font-size: 80px;
                  color: rgba(255, 165, 0, 0.15);"></i>

							<div class="card-body">

								<!-- Main Icon -->
								<span class="avatar rounded-circle bg-warning shadow-sm mb-2"
									  style="width:50px; height:50px; display:flex; align-items:center; justify-content:center;">
									<i class="ti ti-users fs-20 text-white"></i>
								</span>

								<!-- Label -->
								<h6 class="fs-13 fw-medium text-muted mb-1">Total Candidates</h6>

								<!-- Count -->
								<h1 class="mb-0 fw-bold text-warning">@Model.TotalCandidateCounts</h1>
							</div>
						</div>
					</div>

				</div>
			</div>
	

		<div class="row">
				<div class="col-xxl-8 col-xl-7 d-flex">
					<div class="card flex-fill shadow-sm border-0"
						 style="background: linear-gradient(135deg, #e7f1ff, #ffffff);
                border-radius: 18px; position: relative; overflow: hidden;">

						<!-- Background Icon -->
						<i class="ti ti-users"
						   style="position: absolute; right: -25px; bottom: -20px;
                  font-size: 110px; color: rgba(0, 123, 255, 0.12);"></i>

						<div class="card-header pb-2 d-flex align-items-center justify-content-between flex-wrap"
							 style="border-bottom: none;">
							<h5 class="mb-2 fw-bold text-primary">Latest Candidates</h5>

@* 							<div class="dropdown mb-2">
								<a href="javascript:void(0);" class="btn btn-white border btn-sm d-inline-flex align-items-center" data-bs-toggle="dropdown">
									<i class="ti ti-calendar me-1"></i>Latest
								</a>
								<ul class="dropdown-menu dropdown-menu-end p-3">
									<li><a href="#" class="dropdown-item">Today</a></li>
									<li><a href="#" class="dropdown-item">This Week</a></li>
									<li><a href="#" class="dropdown-item">This Month</a></li>
								</ul>
							</div> *@
						</div>

						<div class="card-body p-0">
							<div class="table-responsive">
								<table id="latestCandidatesTable" class="table table-striped table-hover mb-0"
									style="border-radius: 18px; overflow: hidden;">
									<thead class="bg-primary text-white">
										<tr>
											<th>ID</th>
											<th>Name</th>
											@* <th>Skills</th>
											<th>Education</th>
											<th>Experience</th> *@
											<th>Email</th>
										</tr>
									</thead>

									<tbody>
										@foreach (var item in Model.Profiles)
										{
											<tr>
												<td class="fw-bold">@item.Id</td>

												<td>
													<h6 class="fw-semibold">@item.CandidateName</h6>
													<small class="text-muted">@item.Mobile</small>
												</td>

												@* <td>
													<span class="badge bg-primary">@item.Skills</span>
												</td>

												<td>@item.Education</td>

												<td>
													<span class="badge bg-info text-white">@item.Experience</span>
												</td> *@

												<td>
													<span class="badge bg-primary text-white">@item.Email</span>
												</td>
											</tr>
										}
									</tbody>

								</table>
							</div>
						</div>
					</div>
				</div>

				<div class="col-xxl-4 col-xl-5 d-flex">
					<div class="card flex-fill shadow-sm border-0"
						 style="background: linear-gradient(135deg, #fff2ed, #ffffff);
                border-radius: 18px; position: relative; overflow: hidden;">

						<!-- Background Icon -->
						<i class="ti ti-file-text"
						   style="position: absolute; right: -20px; bottom: -20px;
                  font-size: 100px; color: rgba(255, 99, 71, 0.15);"></i>

						<div class="card-header pb-2 d-flex align-items-center justify-content-between flex-wrap"
							 style="border-bottom: none;">
							<h5 class="mb-2 fw-bold text-danger">Latest CV Uploads</h5>

							@* <div class="dropdown mb-2">
								<a href="#" class="btn btn-white border btn-sm d-inline-flex align-items-center" data-bs-toggle="dropdown">
									<i class="ti ti-calendar me-1"></i>Latest
								</a>
								<ul class="dropdown-menu dropdown-menu-end p-3">
									<li><a href="#" class="dropdown-item">Today</a></li>
									<li><a href="#" class="dropdown-item">This Week</a></li>
									<li><a href="#" class="dropdown-item">This Month</a></li>
								</ul>
							</div> *@
						</div>

						<div class="card-body p-0">
							<div class="table-responsive">
								<table id="latestCVTable" class="table table-striped table-hover mb-0">
									<thead class="bg-danger text-white">
										<tr>
											<th>ID</th>
											<th>File Name</th>
											<th>Uploaded On</th>
										</tr>
									</thead>

									<tbody>
										@foreach (var item in Model.CandidateCVs)
										{
											<tr>
												<td class="fw-bold">@item.Id</td>

												<td>
													<h6 class="fw-semibold">@item.FileName</h6>
												</td>

												<td>
													<span class="badge bg-danger text-white">
														@item.UploadedOn.ToString("dd MMM yyyy")
													</span>
												</td>
											</tr>
										}
									</tbody>

								</table>
							</div>
						</div>
					</div>
				</div>


		</div>
			<div class="row">

				<!-- Activity Logs -->
				<div class="col-xxl-12 d-flex">
					<div class="card flex-fill shadow-sm border-0"
						 style="border-radius: 18px; background: linear-gradient(135deg, #f7f9fc, #ffffff); overflow: hidden;">

						<!-- Background icon -->
						<i class="ti ti-activity"
						   style="position: absolute; right: -20px; bottom: -20px; font-size: 120px; color: rgba(0,123,255,0.08);"></i>

						<div class="card-header pb-2 d-flex align-items-center justify-content-between flex-wrap"
							 style="border-bottom: none;">
							<h5 class="mb-2 fw-bold text-primary">Activity Logs</h5>
							<a href="@Url.Action("Index", "ActivityLogs")" class="btn btn-light btn-md mb-2">View All</a>
						</div>

						<div class="card-body p-3">

							@if (Model.ActivityLogs != null && Model.ActivityLogs.Any())
							{
								@foreach (var log in Model.ActivityLogs)
								{
									var actionIcon = "";
									var actionColor = "";

									switch (log.ActionType.ToLower())
									{
										case "added":
										case "create":
											actionIcon = "+";
											actionColor = "bg-success";
											break;
										case "deleted":
										case "remove":
											actionIcon = "-";
											actionColor = "bg-danger";
											break;
										case "updated":
										case "edit":
											actionIcon = "✎";
											actionColor = "bg-warning";
											break;
										default:
											actionIcon = "•";
											actionColor = "bg-primary";
											break;
									}

									<div class="recent-item mb-3 p-3 bg-white rounded-3 shadow-sm d-flex align-items-center justify-content-between">

										<div class="d-flex align-items-center">
											<!-- Action badge -->
											<span class="badge @actionColor text-white fs-6 me-3" style="width:36px; height:36px; display:flex; align-items:center; justify-content:center; border-radius:50%;">
												@actionIcon
											</span>

											<div>
												<div class="d-flex justify-content-between mb-1">
													<h6 class="fs-medium mb-0">@log.PerformedBy</h6>
													<small class="text-muted">@log.PerformedAt.ToString("dd MMM yyyy, hh:mm tt")</small>
												</div>
												<p class="mb-0 fs-13">
													<span class="fw-semibold">@log.ActionType</span> on <span class="text-primary">@log.TableName</span>
												</p>
											</div>
										</div>

										<a href="@Url.Action("Details", "ActivityLog", new { id = log.Id })" class="btn btn-outline-primary btn-xs ms-2">
											<i class="ti ti-info-circle"></i>
										</a>
									</div>
								}
							}
							else
							{
								<p class="text-muted text-center">No activity logs found.</p>
							}

						</div>
					</div>
				</div>

			</div>
		
</div>

</div>
	<div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
		<p class="mb-0">2014 - 2025 &copy; SmartHR.</p>
		<p>Designed &amp; Developed By <a href="javascript:void(0);" class="text-primary">Dreams</a></p>
	</div>

</div>
@section Scripts {
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
		$(document).ready(function () {

			$('#latestCandidatesTable').DataTable({
				"pageLength": 5,
				"lengthChange": false,
				"ordering": true,
				"searching": true
			});

			$('#latestCVTable').DataTable({
				"pageLength": 5,
				"lengthChange": false,
				"ordering": true,
				"searching": true
			});

		});
	</script>

    <script>
        function applyDateFilter() {
            var from = document.getElementById("fromDate").value;
            var to = document.getElementById("toDate").value;
            window.location.href = '@Url.Action("Index")' + '?fromDate=' + from + '&toDate=' + to;
        }

        function clearDateFilter() {
            document.getElementById("fromDate").value = '';
            document.getElementById("toDate").value = '';
            document.getElementById("quickDate").value = '';
        }

        function setQuickDate(option) {
            var from = document.getElementById("fromDate");
            var to = document.getElementById("toDate");
            var today = new Date();
            var start, end;

            switch(option) {
                case "today":
                    start = end = today;
                    break;
                case "yesterday":
                    start = end = new Date(today);
                    start.setDate(today.getDate() - 1);
                    end.setDate(today.getDate() - 1);
                    break;
                case "week":
                    var first = today.getDate() - today.getDay() + 1; // Monday as first day
                    start = new Date(today.setDate(first));
                    end = new Date(today.setDate(first + 6));
                    break;
                case "month":
                    start = new Date(today.getFullYear(), today.getMonth(), 1);
                    end = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case "year":
                    start = new Date(today.getFullYear(), 0, 1);
                    end = new Date(today.getFullYear(), 11, 31);
                    break;
                default:
                    start = end = '';
            }

            from.value = start ? start.toISOString().split('T')[0] : '';
            to.value = end ? end.toISOString().split('T')[0] : '';
        }
    </script>

    <script>
        var toggle = document.getElementById("menu-toggle");
        toggle.addEventListener("click", function () {
            document.getElementById("wrapper").classList.toggle("toggled");
        });
    </script>

}
